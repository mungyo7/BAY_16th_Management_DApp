# BAY Point Marketplace - Product Requirements Document

## 1. 프로젝트 개요

### 1.1 목적
BAY 학회원들이 보유한 포인트 토큰을 활용하여 기프티콘, 상품 등을 구매할 수 있는 온체인 마켓플레이스 구축

### 1.2 핵심 가치
- **투명성**: 모든 거래가 블록체인에 기록되어 투명하게 관리
- **자동화**: 스마트 컨트랙트를 통한 자동화된 거래 처리
- **보안성**: 안전한 토큰 거래 및 상품 구매 프로세스
- **효율성**: 중개자 없는 P2P 거래 시스템

## 2. 주요 기능

### 2.1 상품 관리
- **상품 등록**: 관리자가 판매할 상품/기프티콘 등록
- **상품 수정**: 가격, 재고, 상품 정보 업데이트
- **상품 삭제**: 판매 중단 상품 제거
- **카테고리 관리**: 상품 분류 체계

### 2.2 구매 기능
- **상품 조회**: 판매 중인 상품 목록 및 상세 정보 확인
- **포인트 결제**: BAY 포인트 토큰으로 상품 구매
- **구매 내역**: 개인별 구매 히스토리 조회

### 2.3 재고 관리
- **재고 추적**: 실시간 재고 수량 관리
- **재고 보충**: 관리자의 재고 추가 기능
- **품절 처리**: 재고 소진 시 자동 품절 상태 전환

### 2.4 권한 관리
- **관리자 권한**: 상품 등록/수정/삭제, 재고 관리
- **사용자 권한**: 상품 조회 및 구매
- **권한 이양**: 관리자 권한 이전 기능

## 3. 기술 사양

### 3.1 블록체인
- **네트워크**: Solana Devnet/Mainnet
- **프레임워크**: Anchor Framework
- **언어**: Rust

### 3.2 토큰
- **결제 수단**: BAY Point Token (SPL Token)
- **토큰 표준**: SPL Token Standard

### 3.3 데이터 구조

#### Product (상품)
```rust
struct Product {
    id: u64,                    // 상품 ID
    name: String,               // 상품명
    description: String,        // 상품 설명
    price: u64,                 // 가격 (포인트)
    stock: u64,                 // 재고 수량
    category: String,           // 카테고리
    is_active: bool,            // 판매 상태
    seller: Pubkey,             // 판매자 (관리자)
    created_at: i64,            // 생성 시간
    updated_at: i64,            // 수정 시간
}
```

#### Purchase (구매 기록)
```rust
struct Purchase {
    id: u64,                    // 구매 ID
    product_id: u64,            // 상품 ID
    buyer: Pubkey,              // 구매자
    quantity: u64,              // 구매 수량
    total_price: u64,           // 총 가격
    timestamp: i64,             // 구매 시간
    status: PurchaseStatus,     // 구매 상태
}
```

#### MarketplaceState (마켓플레이스 상태)
```rust
struct MarketplaceState {
    admin: Pubkey,              // 관리자
    token_mint: Pubkey,         // BAY 포인트 토큰 민트
    treasury: Pubkey,           // 재무 계정
    product_count: u64,         // 총 상품 수
    purchase_count: u64,        // 총 구매 수
    total_volume: u64,          // 총 거래량
    fee_percentage: u8,         // 수수료율
}
```

## 4. 주요 명령어 (Instructions)

### 4.1 관리자 기능
- `initialize_marketplace`: 마켓플레이스 초기화
- `add_product`: 새 상품 등록
- `update_product`: 상품 정보 수정
- `deactivate_product`: 상품 비활성화
- `add_stock`: 재고 추가
- `withdraw_funds`: 판매 대금 인출
- `update_fee`: 수수료율 변경
- `transfer_admin`: 관리자 권한 이전

### 4.2 사용자 기능
- `purchase_product`: 상품 구매
- `get_products`: 상품 목록 조회
- `get_product_detail`: 상품 상세 조회
- `get_purchase_history`: 구매 내역 조회

## 5. 보안 고려사항

### 5.1 접근 제어
- 관리자 전용 기능에 대한 권한 검증
- 서명 검증을 통한 사용자 인증

### 5.2 자금 보안
- 에스크로 메커니즘 구현
- 재진입 공격 방지
- 정수 오버플로우/언더플로우 방지

### 5.3 데이터 검증
- 입력 데이터 유효성 검사
- 재고 수량 검증
- 가격 및 수수료 계산 정확성

## 6. 사용자 시나리오

### 6.1 관리자 시나리오
1. 마켓플레이스 초기화
2. 상품 등록 (기프티콘, 굿즈 등)
3. 가격 및 재고 설정
4. 판매 모니터링
5. 판매 대금 정산

### 6.2 구매자 시나리오
1. 상품 목록 탐색
2. 상품 상세 정보 확인
3. BAY 포인트로 구매
4. 구매 확인 및 내역 조회
5. 상품 수령 (오프체인)

## 7. 확장 계획

### Phase 1 (MVP)
- 기본 상품 등록/구매 기능
- 단순 재고 관리
- 기본 권한 시스템

### Phase 2
- 카테고리별 상품 분류
- 할인/프로모션 기능
- 구매 한도 설정

### Phase 3
- NFT 기반 디지털 상품
- 경매 시스템
- 리뷰/평점 시스템
- 환불/취소 기능

## 8. 성공 지표

### 8.1 기술적 지표
- 트랜잭션 처리 속도: < 1초
- 시스템 가용성: > 99.9%
- 스마트 컨트랙트 보안 감사 통과

### 8.2 비즈니스 지표
- 월간 활성 사용자 수
- 월간 거래량
- 평균 구매 금액
- 상품 회전율

## 9. 리스크 및 대응 방안

### 9.1 기술적 리스크
- **네트워크 혼잡**: 트랜잭션 재시도 메커니즘
- **스마트 컨트랙트 버그**: 철저한 테스트 및 감사
- **확장성 문제**: 오프체인 솔루션 고려

### 9.2 운영 리스크
- **재고 관리 오류**: 실시간 모니터링 시스템
- **가격 변동성**: 안정적인 포인트 가치 유지
- **사용자 분쟁**: 명확한 정책 및 분쟁 해결 프로세스

## 10. 타임라인

### Week 1-2: 설계 및 개발 환경 구축
- 상세 설계 문서 작성
- 개발 환경 설정
- 스마트 컨트랙트 구조 설계

### Week 3-4: 핵심 기능 개발
- 마켓플레이스 초기화
- 상품 관리 기능
- 구매 기능

### Week 5: 테스트 및 보안
- 단위 테스트
- 통합 테스트
- 보안 검토

### Week 6: 배포 및 운영
- Devnet 배포
- 사용자 테스트
- Mainnet 배포 준비